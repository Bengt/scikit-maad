

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>features.alpha_indices &mdash; scikit-maad 0.1.4 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> scikit-maad
          

          
          </a>

          
            
            
              <div class="version">
                0.1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/features.html">features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/rois.html">rois</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/sound.html">sound</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/util.html">util</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_auto_examples/index.html">Examples gallery</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">scikit-maad</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>features.alpha_indices</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for features.alpha_indices</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">Alpha indices used in ecoacoustics</span>

<span class="sd">Created on Wed Oct 24 11:56:28 2018</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1"># Authors:  Juan Sebastian ULLOA &lt;lisofomia@gmail.com&gt;</span>
<span class="c1">#           Sylvain HAUPERT &lt;sylvain.haupert@mnhn.fr&gt;        </span>
<span class="c1">#</span>
<span class="c1"># License: New BSD License</span>

<span class="c1">#***************************************************************************</span>
<span class="c1"># -------------------       Load modules         ---------------------------</span>
<span class="c1">#***************************************************************************</span>

<span class="c1"># Import external modules</span>
<span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">diff</span>

<span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">binary_erosion</span><span class="p">,</span> <span class="n">binary_dilation</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">rankdata</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">ndimage</span> <span class="k">as</span> <span class="n">ndi</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">transform</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1">#### Importation from internal modules</span>
<span class="kn">from</span> <span class="nn">maad.util</span> <span class="kn">import</span> <span class="n">rle</span><span class="p">,</span> <span class="n">index_bw</span><span class="p">,</span> <span class="n">linear_scale</span><span class="p">,</span> <span class="n">dB2linear</span><span class="p">,</span> <span class="n">linear2dB</span><span class="p">,</span> <span class="n">plot2D</span>

<span class="c1"># min value</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">_MIN_</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># List of functions</span>
<span class="c1"># =============================================================================</span>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="intoBins"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.intoBins.html#features.alpha_indices.intoBins">[docs]</a><span class="k">def</span> <span class="nf">intoBins</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">an</span><span class="p">,</span> <span class="n">bin_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bin_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bin_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Transform a vector or a matrix into bins </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array-like</span>
<span class="sd">        1D or 2D array.</span>
<span class="sd">    an :1d ndarray of floats </span>
<span class="sd">        Vector containing the positions of each value. </span>
<span class="sd">        In case of 2D matrix, this vector corresponds to the horizontal (row)</span>
<span class="sd">        or vertical (columns) units</span>
<span class="sd">    bin_step : scalar</span>
<span class="sd">        Determine the width of each bin.</span>
<span class="sd">    axis : integer, optional, default is 0</span>
<span class="sd">        Determine  along which axis the transformation is done.</span>
<span class="sd">        In case of matrix :</span>
<span class="sd">        axis = 0 =&gt; transformation is done on column</span>
<span class="sd">        </span>
<span class="sd">        axis = 1 =&gt; transformation is done on row </span>
<span class="sd">    bin_min : scalar, optional, default is None</span>
<span class="sd">        This minimum value corresponds to the start of the first bin. </span>
<span class="sd">        By default, the minimum value is the first value of an.</span>
<span class="sd">    bin_max : scalar, optional, default is None</span>
<span class="sd">        This maximum value corresponds to end of the last bin. </span>
<span class="sd">        By default, the maximum value is the last value of an.   </span>
<span class="sd">    display : boolean, optional, defualt is False</span>
<span class="sd">        Display the result of the tranformation : an histogram</span>
<span class="sd">        In case of matrix, the mean histogram is shown.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xbins :  array-like</span>
<span class="sd">        1D or 2D array which correspond to the data after being transformed into bins</span>
<span class="sd">    bin : 1d ndarray of floats </span>
<span class="sd">        Vector containing the positions of each bin</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    
    <span class="c1"># Test if the bin_step is larger than the resolution of an</span>
    <span class="k">if</span> <span class="n">bin_step</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: bin step must be larger or equal than the actual resolution of x&#39;</span><span class="p">)</span>

    <span class="c1"># In case the limits of the bin are not set</span>
    <span class="k">if</span> <span class="n">bin_min</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bin_min</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">bin_max</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="n">bin_max</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Creation of the bins</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">bin_min</span><span class="p">,</span><span class="n">bin_max</span><span class="o">+</span><span class="n">bin_step</span><span class="p">,</span><span class="n">bin_step</span><span class="p">)</span>
    
    <span class="c1"># select the indices corresponding to the frequency bins range</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xbin</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">an</span><span class="o">&gt;=</span><span class="n">b0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">&lt;</span><span class="n">b</span><span class="p">)</span> 
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">xbin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">indices</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">axis</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">xbin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="n">indices</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">b</span>
      
    <span class="n">xbin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xbin</span><span class="p">)</span> <span class="o">*</span> <span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Display</span>
    <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="c1"># if xbin is a vector</span>
        <span class="k">if</span> <span class="n">xbin</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">an</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="n">xbin</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if xbin is a matrix</span>
            <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">axis</span><span class="o">==</span><span class="mi">1</span> <span class="p">:</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">an</span><span class="p">,</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="n">mean</span><span class="p">(</span><span class="n">xbin</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">bin_step</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">xbin</span><span class="p">,</span> <span class="n">bins</span></div>


<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="skewness"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.skewness.html#features.alpha_indices.skewness">[docs]</a><span class="k">def</span> <span class="nf">skewness</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcul the skewness (asymetry) of a signal x</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray of floats </span>
<span class="sd">        1d signal or 2d matrix</span>
<span class="sd">        </span>
<span class="sd">    axis : integer, optional, default is 0</span>
<span class="sd">        select the axis to compute the kurtosis</span>
<span class="sd">                            </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    ku : float or ndarray of floats</span>
<span class="sd">        skewness of x </span>
<span class="sd">        </span>
<span class="sd">        if x is a 1d vector =&gt; single value</span>
<span class="sd">        </span>
<span class="sd">        if x is a 2d matrix =&gt; array of values corresponding to the number of</span>
<span class="sd">        points in the other axis</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
        <span class="n">mean_x</span> <span class="o">=</span>  <span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">std_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">mean_x</span>
        <span class="n">sk</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Nf</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">std_x</span><span class="o">**</span><span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: type of x must be ndarray&quot;</span><span class="p">)</span> 
        <span class="n">sk</span> <span class="o">=</span> <span class="kc">None</span>
       
    <span class="k">return</span> <span class="n">sk</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="kurtosis"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.kurtosis.html#features.alpha_indices.kurtosis">[docs]</a><span class="k">def</span> <span class="nf">kurtosis</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcul the kurtosis (tailedness or curved or arching) of a signal x</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray of floats </span>
<span class="sd">        1d signal or 2d matrix       </span>
<span class="sd">    axis : integer, optional, default is 0</span>
<span class="sd">        select the axis to compute the kurtosis</span>
<span class="sd">                            </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    ku : float or ndarray of floats</span>
<span class="sd">        kurtosis of x </span>
<span class="sd">        </span>
<span class="sd">        if x is a 1d vector =&gt; single value</span>
<span class="sd">        </span>
<span class="sd">        if x is a 2d matrix =&gt; array of values corresponding to the number of</span>
<span class="sd">        points in the other axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
        <span class="n">mean_x</span> <span class="o">=</span>  <span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">std_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">mean_x</span>
        <span class="n">ku</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Nf</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">std_x</span><span class="o">**</span><span class="mi">4</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: type of x must be ndarray&quot;</span><span class="p">)</span> 
        <span class="n">ku</span> <span class="o">=</span> <span class="kc">None</span>
       
    <span class="k">return</span> <span class="n">ku</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="roughness"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.roughness.html#features.alpha_indices.roughness">[docs]</a><span class="k">def</span> <span class="nf">roughness</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the roughness (depends on the number of peaks and their amplitude)</span>
<span class="sd">    of a vector or matrix x (i.e. waveform, spectrogram...)   </span>
<span class="sd">    Roughness = sum(second_derivation(x)²)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray of floats</span>
<span class="sd">        x is a vector (1d) or a matrix (2d)</span>
<span class="sd">        </span>
<span class="sd">    norm : boolean, optional. Default is None</span>
<span class="sd">    </span>
<span class="sd">        - &#39;global&#39; : normalize by the maximum value in the vector or matrix</span>
<span class="sd">        - &#39;per_axis&#39; : normalize by the maximum value found along each axis</span>

<span class="sd">    axis : int, optional, default is 0</span>
<span class="sd">        select the axis where the second derivation is computed</span>
<span class="sd">        </span>
<span class="sd">        if x is a vector, axis=0</span>
<span class="sd">        </span>
<span class="sd">        if x is a 2d ndarray, axis=0 =&gt; rows, axis=1 =&gt; columns</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    y : float or ndarray of floats</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Described in [Ramsay JO, Silverman BW (2005) Functional data analysis.]</span>
<span class="sd">    Ported from SEEWAVE R Package</span>
<span class="sd">    &quot;&quot;&quot;</span>      
    
    <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;per_axis&#39;</span> <span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> 
            <span class="n">m</span><span class="p">[</span><span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MIN_</span>    <span class="c1"># Avoid dividing by zero value</span>
            <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>
            <span class="k">elif</span> <span class="n">axis</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">m</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;global&#39;</span> <span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="n">_MIN_</span>    <span class="c1"># Avoid dividing by zero value</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">m</span> 
            
    <span class="n">deriv2</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">deriv2</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">r</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="entropy"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.entropy.html#features.alpha_indices.entropy">[docs]</a><span class="k">def</span> <span class="nf">entropy</span> <span class="p">(</span><span class="n">datain</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the entropy of a vector or matrix datain (i.e. waveform, spectrum...)    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    datain : ndarray of floats</span>
<span class="sd">        datain is a vector (1d) or a matrix (2d)</span>

<span class="sd">    axis : int, optional, default is 0</span>
<span class="sd">        select the axis where the entropy is computed</span>
<span class="sd">        </span>
<span class="sd">        if datain is a vector, axis=0</span>
<span class="sd">        </span>
<span class="sd">        if datain is a 2d ndarray, axis=0 =&gt; rows, axis=1 =&gt; columns</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    H : float or ndarray of floats</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">datain</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="n">axis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">datain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: x is empty&quot;</span><span class="p">)</span> 
                <span class="n">H</span> <span class="o">=</span> <span class="kc">None</span> 
            <span class="k">elif</span> <span class="n">datain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">H</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># null entropy</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">datain</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">H</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># null entropy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if datain contains negative values -&gt; rescale the signal between </span>
                <span class="c1"># between posSitive values (for example (0,1))</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">datain</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">datain</span> <span class="o">=</span> <span class="n">linear_scale</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">minval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">maxval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># length of datain along axis</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">datain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
                <span class="c1"># Tranform the signal into a Probability mass function (pmf)</span>
                <span class="c1"># Sum(pmf) = 1</span>
                <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">pmf</span> <span class="o">=</span> <span class="n">datain</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">axis</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> 
                    <span class="n">pmf</span> <span class="o">=</span> <span class="p">(</span><span class="n">datain</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">axis</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="n">pmf</span><span class="p">[</span><span class="n">pmf</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MIN_</span>
                <span class="c1">#normalized by the length : H=&gt;[0,1]</span>
                <span class="n">H</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">pmf</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">pmf</span><span class="p">),</span><span class="n">axis</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING :axis is greater than the dimension of the array&quot;</span><span class="p">)</span>    
            <span class="n">H</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: type of datain must be ndarray&quot;</span><span class="p">)</span>   
        <span class="n">H</span> <span class="o">=</span> <span class="kc">None</span> 

    <span class="k">return</span> <span class="n">H</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="score"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.score.html#features.alpha_indices.score">[docs]</a><span class="k">def</span> <span class="nf">score</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Score</span>

<span class="sd">    count the number of times values in x that are greater than the threshold </span>
<span class="sd">    and normalized by the total number of values in x</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray of floats</span>
<span class="sd">        Vector or matrix containing the data</span>
<span class="sd">        </span>
<span class="sd">    threshold : scalar</span>
<span class="sd">        Value &gt; threshold are counted    </span>
<span class="sd">        </span>
<span class="sd">    axis : integer, optional, default is 0</span>
<span class="sd">        score is calculated along this axis.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    count : scalar</span>
<span class="sd">        the number of times values in x that are greater than the threshold</span>
<span class="sd">    s : scalar</span>
<span class="sd">        count is normalized by the total number of values in x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">&gt;=</span><span class="n">threshold</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="gini"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.gini.html#features.alpha_indices.gini">[docs]</a><span class="k">def</span> <span class="nf">gini</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">corr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gini</span>
<span class="sd">    </span>
<span class="sd">    Compute the Gini value of x</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray of floats</span>
<span class="sd">        Vector or matrix containing the data</span>
<span class="sd">    </span>
<span class="sd">    corr : boolean, optional, default is False</span>
<span class="sd">        Correct the Gini value</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------  </span>
<span class="sd">    G: scalar</span>
<span class="sd">        Gini value</span>
<span class="sd">        </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Ported from ineq library in R</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
       <span class="n">G</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># null gini</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">G</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">G</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">G</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">corr</span> <span class="p">:</span> <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="o">/</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">G</span><span class="o">=</span> <span class="n">G</span><span class="o">/</span><span class="n">n</span>
    <span class="k">return</span> <span class="n">G</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="shannonEntropy"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.shannonEntropy.html#features.alpha_indices.shannonEntropy">[docs]</a><span class="k">def</span> <span class="nf">shannonEntropy</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shannon Entropy</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    datain : ndarray of floats</span>
<span class="sd">        Vector or matrix containing the data</span>
<span class="sd">    </span>
<span class="sd">    axis : integer, optional, default is 0</span>
<span class="sd">        entropy is calculated along this axis.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    Hs : ndarray of floats</span>
<span class="sd">        Vector or matrix of Shannon Entropy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># length of datain along axis</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">datain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
    <span class="n">Hs</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Hs</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="acousticRichnessIndex"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.acousticRichnessIndex.html#features.alpha_indices.acousticRichnessIndex">[docs]</a><span class="k">def</span> <span class="nf">acousticRichnessIndex</span> <span class="p">(</span><span class="n">Ht_array</span><span class="p">,</span> <span class="n">M_array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic richness index : AR</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Ht_array : 1d ndarray of floats</span>
<span class="sd">        Vector containing the temporal entropy Ht of the selected files </span>
<span class="sd">    </span>
<span class="sd">    M_array: 1d ndarray of floats</span>
<span class="sd">        Vector containing the amplitude index M  of the selected files </span>

<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    AR : 1d ndarray of floats</span>
<span class="sd">        Vector of acoustic richenss index</span>
<span class="sd">        </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Described in [Depraetere &amp; al. 2012]</span>
<span class="sd">    Ported from SEEWAVE R package</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ht_array</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">M_array</span><span class="p">)</span> <span class="p">:</span> 
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;warning : Ht_array and M_array must have the same length&quot;</span><span class="p">)</span>
    
    <span class="n">AR</span> <span class="o">=</span> <span class="n">rankdata</span><span class="p">(</span><span class="n">Ht_array</span><span class="p">)</span> <span class="o">*</span> <span class="n">rankdata</span><span class="p">(</span><span class="n">M_array</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ht_array</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">return</span> <span class="n">AR</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="acousticComplexityIndex"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.acousticComplexityIndex.html#features.alpha_indices.acousticComplexityIndex">[docs]</a><span class="k">def</span> <span class="nf">acousticComplexityIndex</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span><span class="s1">&#39;global&#39;</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic Complexity Index : ACI</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        2d : Spectrogram (i.e matrix of spectrum)</span>
<span class="sd">    </span>
<span class="sd">    norm : string, optional, default is &#39;global&#39;</span>
<span class="sd">        Determine if the ACI is normalized by the sum on the whole frequencies</span>
<span class="sd">        (&#39;global&#39; mode) or by the sum of frequency bin per frequency bin </span>
<span class="sd">        (&#39;per_bin&#39;)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    ACI_xx : 2d ndarray of scalars</span>
<span class="sd">        Acoustic Complexity Index of the spectrogram</span>
<span class="sd">    </span>
<span class="sd">    ACI_per_bin : 1d ndarray of scalars</span>
<span class="sd">        ACI value for each frequency bin</span>
<span class="sd">        sum(ACI_xx,axis=1)</span>
<span class="sd">        </span>
<span class="sd">    ACI_sum : scalar</span>
<span class="sd">        Sum of ACI value per frequency bin (Common definition)</span>
<span class="sd">        sum(ACI_per_bin)</span>
<span class="sd">        </span>
<span class="sd">    ACI_mean ; scalar</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----    </span>
<span class="sd">    !!! pas de sens car non independant de la résolution freq et temporelle</span>
<span class="sd">    </span>
<span class="sd">    !!! Seulement sum donne un résultat independant de N (pour la FFT)  </span>
<span class="sd">    </span>
<span class="sd">    !!! et donc de df et dt</span>
<span class="sd">        </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Pieretti N, Farina A, Morri FD (2011) A new methodology to infer the singing </span>
<span class="sd">    activity of an avian community: the Acoustic Complexity Index (ACI). </span>
<span class="sd">    Ecological Indicators, 11, 868-873.</span>
<span class="sd">    </span>
<span class="sd">    Ported from the Seewave R package.</span>
<span class="sd">    </span>
<span class="sd">    !!!!! in Seewave, the result is the sum of the ACI per bin.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;per_bin&#39;</span><span class="p">:</span>
        <span class="n">ACI_xx</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;global&#39;</span><span class="p">:</span>
        <span class="n">ACI_xx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">Sxx</span><span class="p">))</span>

    <span class="n">ACI_per_bin</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ACI_xx</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ACI_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ACI_per_bin</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ACI_xx</span><span class="p">,</span> <span class="n">ACI_per_bin</span><span class="p">,</span> <span class="n">ACI_sum</span><span class="p">,</span> </div>


<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="acousticDiversityIndex"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.acousticDiversityIndex.html#features.alpha_indices.acousticDiversityIndex">[docs]</a><span class="k">def</span> <span class="nf">acousticDiversityIndex</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> 
                            <span class="n">dB_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;shannon&quot;</span><span class="p">,</span> <span class="n">R_compatible</span> <span class="o">=</span> <span class="s1">&#39;soundecology&#39;</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic Diversity Index : ADI</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        2d : Spectrogram</span>
<span class="sd">    </span>
<span class="sd">    fn : 1d ndarray of floats</span>
<span class="sd">        frequency vector</span>
<span class="sd">    </span>
<span class="sd">    fmin : scalar, optional, default is 0</span>
<span class="sd">        Minimum frequency in Hz</span>
<span class="sd">        </span>
<span class="sd">    fmax : scalar, optional, default is 20000</span>
<span class="sd">        Maximum frequency in Hz</span>
<span class="sd">        </span>
<span class="sd">    bin_step : scalar, optional, default is 500</span>
<span class="sd">        Frequency step in Hz</span>
<span class="sd">    </span>
<span class="sd">    dB_threshold : scalar, optional, default is 3dB</span>
<span class="sd">        Threshold to compute the score (ie. the number of data &gt; threshold,</span>
<span class="sd">        normalized by the length)</span>
<span class="sd">        </span>
<span class="sd">    index : string, optional, default is &quot;shannon&quot;</span>
<span class="sd">        - &quot;shannon&quot; : Shannon entropy is calculated on the vector of scores</span>
<span class="sd">        </span>
<span class="sd">        - &quot;simpson&quot; : Simpson index is calculated on the vector of scores</span>
<span class="sd">        </span>
<span class="sd">        - &quot;invsimpson&quot; : Inverse Simpson index is calculated on the vector of scores</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    ADI : scalar </span>
<span class="sd">        Acoustic Diversity Index of the spectrogram (ie. index of the vector </span>
<span class="sd">        of scores)</span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Villanueva-Rivera, L. J., B. C. Pijanowski, J. Doucette, and B. Pekin. 2011. </span>
<span class="sd">    A primer of acoustic analysis for landscape ecologists. Landscape Ecology 26: 1233-1246.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># number of frequency intervals to compute the score</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">fmax</span><span class="o">-</span><span class="n">fmin</span><span class="p">)</span><span class="o">/</span><span class="n">bin_step</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">R_compatible</span> <span class="o">==</span> <span class="s1">&#39;soundecology&#39;</span> <span class="p">:</span>
        <span class="c1"># convert into dB and normalization by the max</span>
        <span class="n">Sxx_dB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">Sxx</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">Sxx</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="c1"># convert into dB </span>
        <span class="n">Sxx_dB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>         
    
    <span class="c1"># Score for each frequency in the frequency bandwith</span>
    <span class="n">s_sum</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fmin</span><span class="o">+</span><span class="n">bin_step</span><span class="o">*</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f0</span><span class="o">+</span><span class="n">bin_step</span><span class="p">)</span>
        <span class="n">s</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">Sxx_dB</span><span class="p">[</span><span class="n">index_bw</span><span class="p">(</span><span class="n">fn</span><span class="p">,(</span><span class="n">f0</span><span class="p">,</span><span class="n">f1</span><span class="p">)),:],</span> <span class="n">threshold</span><span class="o">=</span><span class="n">dB_threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">s_sum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s_sum</span><span class="p">)</span>
    
    <span class="c1"># Entropy</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span><span class="s2">&quot;shannon&quot;</span><span class="p">:</span>
        <span class="n">ADI</span> <span class="o">=</span> <span class="n">shannonEntropy</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="s2">&quot;simpson&quot;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">ADI</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="s2">&quot;invsimpson&quot;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">ADI</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>   
    
    <span class="k">return</span> <span class="n">ADI</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="acousticEvenessIndex"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.acousticEvenessIndex.html#features.alpha_indices.acousticEvenessIndex">[docs]</a><span class="k">def</span> <span class="nf">acousticEvenessIndex</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> 
                          <span class="n">dB_threshold</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">R_compatible</span> <span class="o">=</span> <span class="s1">&#39;soundecology&#39;</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic Eveness Index : AEI</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx: ndarray of floats</span>
<span class="sd">        2d : Spectrogram</span>
<span class="sd">    </span>
<span class="sd">    fn : 1d ndarray of floats</span>
<span class="sd">        frequency vector</span>
<span class="sd">    </span>
<span class="sd">    fmin : scalar, optional, default is 0</span>
<span class="sd">        Minimum frequency in Hz</span>
<span class="sd">        </span>
<span class="sd">    fmax : scalar, optional, default is 20000</span>
<span class="sd">        Maximum frequency in Hz</span>
<span class="sd">        </span>
<span class="sd">    bin_step : scalar, optional, default is 500</span>
<span class="sd">        Frequency step in Hz</span>
<span class="sd">    </span>
<span class="sd">    dB_threshold : scalar, optional, default is -50</span>
<span class="sd">        Threshold to compute the score (ie. the number of data &gt; threshold,</span>
<span class="sd">        normalized by the length)</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    AEI : scalar </span>
<span class="sd">        Acoustic Eveness of the spectrogram (ie. Gini of the vector of scores)</span>
<span class="sd">        </span>
<span class="sd">    References </span>
<span class="sd">    ----------</span>
<span class="sd">    Villanueva-Rivera, L. J., B. C. Pijanowski, J. Doucette, and B. Pekin. 2011. </span>
<span class="sd">    A primer of acoustic analysis for landscape ecologists. Landscape Ecology 26: 1233-1246.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># number of frequency intervals to compute the score</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">fmax</span><span class="o">-</span><span class="n">fmin</span><span class="p">)</span><span class="o">/</span><span class="n">bin_step</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">R_compatible</span> <span class="o">==</span> <span class="s1">&#39;soundecology&#39;</span> <span class="p">:</span>
        <span class="c1"># convert into dB and normalization by the max</span>
        <span class="n">Sxx_dB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">Sxx</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">Sxx</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="c1"># convert into dB </span>
        <span class="n">Sxx_dB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>   
    
    <span class="c1"># Score for each frequency in the frequency bandwith</span>
    <span class="n">s_sum</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fmin</span><span class="o">+</span><span class="n">bin_step</span><span class="o">*</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f0</span><span class="o">+</span><span class="n">bin_step</span><span class="p">)</span>
        <span class="n">s</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">Sxx_dB</span><span class="p">[</span><span class="n">index_bw</span><span class="p">(</span><span class="n">fn</span><span class="p">,(</span><span class="n">f0</span><span class="p">,</span><span class="n">f1</span><span class="p">)),:],</span> <span class="n">threshold</span><span class="o">=</span><span class="n">dB_threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">s_sum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s_sum</span><span class="p">)</span>
    
    <span class="c1"># Gini</span>
    <span class="n">AEI</span> <span class="o">=</span> <span class="n">gini</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">AEI</span></div>

<span class="c1">#=============================================================================</span>

<span class="c1">####    Indices based on the entropy</span>

<div class="viewcode-block" id="spectral_entropy"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.spectral_entropy.html#features.alpha_indices.spectral_entropy">[docs]</a><span class="k">def</span> <span class="nf">spectral_entropy</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spectral entropy : EAS, ECU, ECV, EPS, </span>
<span class="sd">    </span>
<span class="sd">    + kurtosis and skewness : KURT, SKEW</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : ndarray of floats</span>
<span class="sd">        Spectrum (1d) or Spectrogram (2d). </span>
<span class="sd">        Better to use the PSD to be consistent with energy</span>
<span class="sd">    </span>
<span class="sd">    fn : 1d ndarray of floats</span>
<span class="sd">        frequency vector</span>
<span class="sd">    </span>
<span class="sd">    flim : tupple (fmin, fmax), optional, default is None</span>
<span class="sd">        Frequency band used to compute the spectral entropy.</span>
<span class="sd">        For instance, one may want to compute the spectral entropy for the </span>
<span class="sd">        biophony bandwidth</span>
<span class="sd">    </span>
<span class="sd">    display : boolean, optional, default is False</span>
<span class="sd">        Display the different spectra (mean, variance, covariance, max...)</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------     </span>
<span class="sd">    EAS : scalar</span>
<span class="sd">        Entropy of spectrum</span>
<span class="sd">    ECU : scalar</span>
<span class="sd">        Entropy of spectral variance (along the time axis for each frequency)</span>
<span class="sd">    ECV : scalar</span>
<span class="sd">        Entropy of coefficient of variance (along the time axis for each frequency)</span>
<span class="sd">    EPS : scalar</span>
<span class="sd">        Entropy of spectral maxima </span>
<span class="sd">    KURT : scalar</span>
<span class="sd">        Kurtosis of spectral maxima</span>
<span class="sd">    SKEW : scalar</span>
<span class="sd">        Skewness of spectral maxima</span>
<span class="sd">        </span>
<span class="sd">    References </span>
<span class="sd">    ----------</span>
<span class="sd">    Credit : </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flim</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: flim must be a tupple (fmin, fmax) or None&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="k">if</span> <span class="n">flim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">flim</span><span class="o">=</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">fn</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    
    <span class="c1"># select the indices corresponding to the frequency range</span>
    <span class="n">iBAND</span> <span class="o">=</span> <span class="n">index_bw</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">flim</span><span class="p">)</span>

    <span class="c1"># TOWSEY &amp; BUXTON : only on the bio band</span>
    <span class="c1"># EAS [TOWSEY] #</span>
     
    <span class="c1">####  COMMENT : Result a bit different due to different Hilbert implementation</span>
    
    <span class="n">X_mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Hf</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">X_mean</span><span class="p">)</span>
    <span class="n">EAS</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Hf</span>

    <span class="c1">#### Entropy of spectral variance (along the time axis for each frequency)</span>
    <span class="sd">&quot;&quot;&quot; ECU [TOWSEY] &quot;&quot;&quot;</span>
    <span class="n">X_Var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Hf_var</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">X_Var</span><span class="p">)</span>
    <span class="n">ECU</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Hf_var</span>

    <span class="c1">#### Entropy of coefficient of variance (along the time axis for each frequency)</span>
    <span class="sd">&quot;&quot;&quot; ECV [TOWSEY] &quot;&quot;&quot;</span>
    <span class="n">X_CoV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Hf_CoV</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">X_CoV</span><span class="p">)</span>
    <span class="n">ECV</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Hf_CoV</span>
    
    <span class="c1">#### Entropy of spectral maxima </span>
    <span class="sd">&quot;&quot;&quot; EPS [TOWSEY]  &quot;&quot;&quot;</span>
    <span class="n">ioffset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">iBAND</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">Nbins</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">iBAND</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span>    
    <span class="n">imax_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">ioffset</span>
    <span class="n">imax_X</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[</span><span class="n">imax_X</span><span class="p">]</span>
    <span class="n">max_X_bin</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">imax_X</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">Nbins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">flim</span><span class="p">)</span>
    <span class="n">max_X_bin</span> <span class="o">=</span> <span class="n">max_X_bin</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">max_X_bin</span><span class="p">)</span>
    <span class="n">Hf_fmax</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">max_X_bin</span><span class="p">)</span>
    <span class="n">EPS</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Hf_fmax</span>    
    
    <span class="c1">#### Kurtosis of spectral maxima</span>
    <span class="n">KURT</span> <span class="o">=</span> <span class="n">kurtosis</span><span class="p">(</span><span class="n">max_X_bin</span><span class="p">)</span>
    
    <span class="c1">#### skewness of spectral maxima</span>
    <span class="n">SKEW</span> <span class="o">=</span> <span class="n">skewness</span><span class="p">(</span><span class="n">max_X_bin</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">display</span><span class="p">:</span> 
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">X_mean</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">X_mean</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalized mean Axx&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">X_Var</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">X_Var</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalized variance Axx&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">X_CoV</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">X_CoV</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalized covariance Axx&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">max_X_bin</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">max_X_bin</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalized Spectral max Axx&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Signals&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">EAS</span><span class="p">,</span> <span class="n">ECU</span><span class="p">,</span> <span class="n">ECV</span><span class="p">,</span> <span class="n">EPS</span><span class="p">,</span> <span class="n">KURT</span><span class="p">,</span> <span class="n">SKEW</span></div>


<span class="c1">#=============================================================================</span>

<span class="c1">####    Indices based on the energy</span>

    
<span class="k">def</span> <span class="nf">_energy_per_freqbin</span> <span class="p">(</span><span class="n">PSDxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">flim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20000</span><span class="p">),</span> <span class="n">bin_step</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
        
    <span class="c1">#Convert into bins</span>
    <span class="n">PSDxx_bins</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">intoBins</span><span class="p">(</span><span class="n">PSDxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">bin_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bin_max</span><span class="o">=</span><span class="n">fn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                              <span class="n">bin_step</span><span class="o">=</span><span class="n">bin_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   
    
    <span class="c1"># select the indices corresponding to the frequency bins range</span>
    <span class="n">indf</span> <span class="o">=</span> <span class="n">index_bw</span> <span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">flim</span><span class="p">)</span> 

    <span class="c1"># select the frequency bins and take the min</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">PSDxx_bins</span><span class="p">[</span><span class="n">indf</span><span class="p">,</span> <span class="p">])</span>
    
    <span class="k">return</span> <span class="n">energy</span>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="soundscapeIndex"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.soundscapeIndex.html#features.alpha_indices.soundscapeIndex">[docs]</a><span class="k">def</span> <span class="nf">soundscapeIndex</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">flim_bioPh</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="mi">10000</span><span class="p">),</span><span class="n">flim_antroPh</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span> 
                     <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    soundscapeIndex</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        2d : Amplitude Spectrogram</span>
<span class="sd">    </span>
<span class="sd">    fn : vector</span>
<span class="sd">        frequency vector </span>
<span class="sd">        </span>
<span class="sd">    flim_bioPh : tupple (fmin, fmax), optional, default is (1000,10000)</span>
<span class="sd">        Frequency band of the biophony</span>
<span class="sd">    </span>
<span class="sd">    flim_antroPh: tupple (fmin, fmax), optional, default is (0,1000)</span>
<span class="sd">        Frequency band of the anthropophony</span>
<span class="sd">    </span>
<span class="sd">    step: optional, default is None</span>
<span class="sd">        if step is None, keep the original frequency resolution, otherwise,</span>
<span class="sd">        the spectrogram is converted into new frequency bins</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    NDSI : scalar</span>
<span class="sd">        (bioPh-antroPh)/(bioPh+antroPh)</span>
<span class="sd">    ratioBA : scalar</span>
<span class="sd">        biophonic energy / anthropophonic energy</span>
<span class="sd">    antroPh : scalar</span>
<span class="sd">        Acoustic energy in the anthropophonic bandwidth</span>
<span class="sd">    bioPh : scalar</span>
<span class="sd">        Acoustic energy in the biophonic bandwidth</span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Kasten, Eric P., Stuart H. Gage, Jordan Fox, and Wooyeong Joo. 2012. </span>
<span class="sd">    The Remote Environmental Assessment Laboratory&#39;s Acoustic Library: An Archive </span>
<span class="sd">    for Studying Soundscape Ecology. Ecological Informatics 12: 50-67.</span>
<span class="sd">    </span>
<span class="sd">    Inspired by Seewave R package</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Frequency resolution</span>
    <span class="c1"># if step is None, keep the original frequency resolution, otherwise,</span>
    <span class="c1"># the spectrogram is converted into new frequency bins</span>
    <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">step</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Convert Sxx (amplitude) into PSDxx (energy)</span>
    <span class="n">PSDxx</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Energy in BIOBAND</span>
    <span class="n">bioPh</span> <span class="o">=</span> <span class="n">_energy_per_freqbin</span><span class="p">(</span><span class="n">PSDxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim_bioPh</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
    <span class="c1"># Energy in ANTHROPOBAND</span>
    <span class="n">antroPh</span> <span class="o">=</span> <span class="n">_energy_per_freqbin</span><span class="p">(</span><span class="n">PSDxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="n">flim_antroPh</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
    
    <span class="c1"># NDSI and ratioBA indices </span>
    <span class="n">NDSI</span> <span class="o">=</span> <span class="p">(</span><span class="n">bioPh</span><span class="o">-</span><span class="n">antroPh</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">bioPh</span><span class="o">+</span><span class="n">antroPh</span><span class="p">)</span>
    <span class="n">ratioBA</span> <span class="o">=</span> <span class="n">bioPh</span> <span class="o">/</span> <span class="n">antroPh</span>
    
    <span class="k">return</span> <span class="n">NDSI</span><span class="p">,</span> <span class="n">ratioBA</span><span class="p">,</span> <span class="n">antroPh</span><span class="p">,</span> <span class="n">bioPh</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="bioacousticsIndex"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.bioacousticsIndex.html#features.alpha_indices.bioacousticsIndex">[docs]</a><span class="k">def</span> <span class="nf">bioacousticsIndex</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">),</span> <span class="n">R_compatible</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bioacoustics Index</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        matrix : Spectrogram  </span>
<span class="sd">    </span>
<span class="sd">    fn : vector</span>
<span class="sd">        frequency vector </span>
<span class="sd">    </span>
<span class="sd">    flim : tupple (fmin, fmax), optional, default is (2000, 15000)</span>
<span class="sd">        Frequency band used to compute the bioacoustic index.</span>
<span class="sd">        </span>
<span class="sd">    R_compatible : Boolean, optional, default is False</span>
<span class="sd">        if True, the result is similar to the package SoundEcology in R </span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    BI : scalar</span>
<span class="sd">        Bioacoustics Index</span>
<span class="sd">    </span>
<span class="sd">    References </span>
<span class="sd">    ----------</span>
<span class="sd">    References: Boelman NT, Asner GP, Hart PJ, Martin RE. 2007. Multi-trophic </span>
<span class="sd">    invasion resistance in Hawaii: bioacoustics, field surveys, and airborne </span>
<span class="sd">    remote sensing. Ecological Applications 17: 2137-2144.</span>
<span class="sd">    </span>
<span class="sd">    Ported and modified from the soundecology R package.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----    </span>
<span class="sd">    Soundecology compatible version</span>
<span class="sd">    - average of dB value</span>
<span class="sd">    - remove negative value in order to get positive values only</span>
<span class="sd">    - dividing by the frequency resolution df instead of multiplication</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    
    <span class="c1"># select the indices corresponding to the frequency bins range</span>
    <span class="n">indf</span> <span class="o">=</span> <span class="n">index_bw</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">flim</span><span class="p">)</span>
    
    <span class="c1"># frequency resolution. </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># ======= As soundecology</span>
    <span class="k">if</span> <span class="n">R_compatible</span> <span class="o">==</span> <span class="kc">True</span> <span class="p">:</span>
        <span class="c1"># Mean Sxx normalized by the max</span>
        <span class="n">meanSxx</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Sxx</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">Sxx</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Convert into dB</span>
        <span class="n">meanSxxdB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">meanSxx</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>
        
        <span class="c1"># &quot;normalization&quot; in order to get positive &#39;vectical&#39; values </span>
        <span class="n">meanSxxdB</span> <span class="o">=</span> <span class="n">meanSxxdB</span><span class="p">[</span><span class="n">indf</span><span class="p">,]</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">meanSxxdB</span><span class="p">[</span><span class="n">indf</span><span class="p">,])</span>
    
        <span class="c1"># this is not the area under the curve...</span>
        <span class="c1"># what is the meaning of an area under the curve in dB...</span>
        <span class="n">BI</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">meanSxxdB</span><span class="p">)</span><span class="o">/</span><span class="n">df</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># normalize by the max of the spectrogram</span>
        <span class="c1"># better to average the PSD for energy conservation</span>
        <span class="n">PSDxx_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sxx</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">Sxx</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">meanPSDxx_norm</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">PSDxx_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Compute the area</span>
        <span class="c1"># take the sqrt in order to go back to Sxx</span>
        <span class="n">BI</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">meanPSDxx_norm</span><span class="p">))</span><span class="o">*</span> <span class="n">df</span> 
        
    <span class="k">return</span> <span class="n">BI</span></div>
    

<span class="c1">####    Indices based on the acoustic event  ####</span>
    


<div class="viewcode-block" id="acoustic_activity"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.acoustic_activity.html#features.alpha_indices.acoustic_activity">[docs]</a><span class="k">def</span> <span class="nf">acoustic_activity</span> <span class="p">(</span><span class="n">xdB</span><span class="p">,</span> <span class="n">dB_threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic Activity :</span>
<span class="sd">    </span>
<span class="sd">    for each frequency bin :</span>
<span class="sd">    - ACTfract : proportion (fraction) of points above the threshold </span>
<span class="sd">    - ACTcount : number of points above the threshold</span>
<span class="sd">    - ACTmean : mean value (in dB) of the portion of the signal above the threhold</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xdB : ndarray of floats</span>
<span class="sd">        1d : envelope in dB</span>
<span class="sd">        2d : PSD spectrogram in dB</span>
<span class="sd">        It&#39;s better to work with PSD or envelope without background variation</span>
<span class="sd">        as the process is based on threshold.</span>

<span class="sd">    dt : scalar</span>
<span class="sd">        Time resolution</span>

<span class="sd">    dB_threshold : scalar, optional, default is 6dB</span>
<span class="sd">        data &gt;Threshold is considered to be an event </span>
<span class="sd">        if the length is &gt; rejectLength</span>
<span class="sd">        </span>
<span class="sd">    rejectDuration : scalar, optional, default is None</span>
<span class="sd">        event shorter than rejectDuration are discarded</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    ACTfract :ndarray of scalars</span>
<span class="sd">        proportion (fraction) of points above the threshold for each frequency bin</span>
<span class="sd">    ACTcount: ndarray of scalars</span>
<span class="sd">        number of points above the threshold for each frequency bin</span>
<span class="sd">    ACTmean: scalar</span>
<span class="sd">        mean value (in dB) of the portion of the signal above the threhold</span>
<span class="sd">        </span>
<span class="sd">    References </span>
<span class="sd">    ----------</span>
<span class="sd">    Towsey, Michael W. (2013) Noise removal from wave-forms and spectrograms derived </span>
<span class="sd">    from natural recordings of the environment.</span>
<span class="sd">    Towsey, Michael (2013), Noise Removal from Waveforms and Spectrograms Derived </span>
<span class="sd">    from Natural Recordings of the Environment. Queensland University of Technology, Brisbane.</span>
<span class="sd">    </span>
<span class="sd">    ACTsp [Towsey] : ACTfract (proportion (fraction) of point value above the theshold)</span>
<span class="sd">    EVNsp [Towsey] : ACTcount (number of point value above the theshold)</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">ACTfract</span><span class="p">,</span> <span class="n">ACTcount</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">xdB</span><span class="p">,</span> <span class="n">dB_threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">ACTfract</span><span class="o">=</span> <span class="n">ACTfract</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">ACTcount</span> <span class="o">=</span> <span class="n">ACTcount</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">ACTmean</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">dB2linear</span><span class="p">(</span><span class="n">xdB</span><span class="p">[</span><span class="n">xdB</span><span class="o">&gt;</span><span class="n">dB_threshold</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;power&#39;</span><span class="p">)),</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ACTfract</span><span class="p">,</span> <span class="n">ACTcount</span><span class="p">,</span> <span class="n">ACTmean</span></div>
       

<span class="c1">#=============================================================================     </span>
<div class="viewcode-block" id="acoustic_events"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.acoustic_events.html#features.alpha_indices.acoustic_events">[docs]</a><span class="k">def</span> <span class="nf">acoustic_events</span><span class="p">(</span><span class="n">xdB</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dB_threshold</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">rejectDuration</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic events :</span>
<span class="sd">        - EVNsum : total events duration (s) </span>
<span class="sd">        - EVNmean : mean events duration (s)</span>
<span class="sd">        - EVNcount : number of events per s</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xdB : ndarray of floats</span>
<span class="sd">        2d : Spectrogram  in dB</span>

<span class="sd">    dt : scalar</span>
<span class="sd">        Time resolution</span>

<span class="sd">    dB_threshold : scalar, optional, default is 6dB</span>
<span class="sd">        data &gt;Threshold is considered to be an event </span>
<span class="sd">        if the length is &gt; rejectLength</span>
<span class="sd">        </span>
<span class="sd">    rejectDuration : scalar, optional, default is None</span>
<span class="sd">        event shorter than rejectDuration are discarded</span>
<span class="sd">        duration is in s</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    EVNsum :scalar</span>
<span class="sd">    EVNmean: scalar</span>
<span class="sd">    EVNcount: scalar</span>
<span class="sd">    EVN: ndarray of floats </span>

<span class="sd">    References </span>
<span class="sd">    ----------</span>
<span class="sd">    Towsey, Michael W. (2013) Noise removal from wave-forms and spectrograms derived </span>
<span class="sd">    from natural recordings of the environment.</span>
<span class="sd">    Towsey, Michael (2013), Noise Removal from Waveforms and Spectrograms Derived </span>
<span class="sd">    from Natural Recordings of the Environment. Queensland University of Technology, Brisbane.</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># total duration</span>
    <span class="k">if</span> <span class="n">xdB</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span><span class="mi">1</span> <span class="p">:</span> <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xdB</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="k">if</span> <span class="n">xdB</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span><span class="mi">2</span> <span class="p">:</span> <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdB</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    
    <span class="n">xdB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xdB</span><span class="p">)</span>
    <span class="c1"># thresholding =&gt; binary</span>
    <span class="n">EVN</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdB</span><span class="o">&gt;=</span><span class="n">dB_threshold</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span>  
    <span class="c1"># Remove events shorter than &#39;rejectLength&#39; </span>
    <span class="c1"># (done by erosion+dilation = opening)</span>
    <span class="k">if</span> <span class="n">rejectDuration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rejectLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rejectDuration</span> <span class="o">/</span> <span class="n">dt</span><span class="p">))</span>
        <span class="c1"># tricks. Depending on the dimension of bin_x </span>
        <span class="c1"># if bin_x is a vector</span>
        <span class="k">if</span> <span class="n">EVN</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rejectLength</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># if bin_x is a matrix</span>
        <span class="k">elif</span> <span class="n">EVN</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">kernel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rejectLength</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span>  
        <span class="k">else</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xdB must be a vector or a matrix&quot;</span><span class="p">)</span>
        <span class="c1"># Morphological tool : Opening</span>
        <span class="n">EVN</span> <span class="o">=</span> <span class="n">binary_erosion</span><span class="p">(</span><span class="n">EVN</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">kernel</span><span class="p">)</span>
        <span class="n">EVN</span> <span class="o">=</span> <span class="n">binary_dilation</span><span class="p">(</span><span class="n">EVN</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">kernel</span><span class="p">)</span> 
    
    <span class="c1"># Extract the characteristics of each event : </span>
    <span class="c1"># duration (mean and sum in s) and count</span>
    <span class="k">if</span> <span class="n">EVN</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span>
        <span class="n">EVNsum</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">EVNmean</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">EVNcount</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">EVN</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">rle</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span> <span class="p">:</span>
                <span class="c1"># mean events duration in s</span>
                <span class="n">EVNmean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">EVNmean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>    
            <span class="c1"># total events duration in s </span>
            <span class="n">EVNsum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
            <span class="c1"># number of events</span>
            <span class="n">EVNcount</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span> <span class="n">duration</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">EVN</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
        <span class="n">l</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">rle</span><span class="p">(</span><span class="n">EVN</span><span class="p">)</span> 
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span><span class="mi">0</span> <span class="p">:</span>
            <span class="c1"># mean events duration in s</span>
            <span class="n">EVNmean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">EVNmean</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># total events duration in s </span>
        <span class="n">EVNsum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="c1"># number of events per s</span>
        <span class="n">EVNcount</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">duration</span>
    <span class="k">else</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xdB must be a vector or a matrix&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">EVNsum</span><span class="p">,</span> <span class="n">EVNmean</span><span class="p">,</span> <span class="n">EVNcount</span><span class="p">,</span> <span class="n">EVN</span></div>


<span class="c1">#========================================</span>
    
<span class="c1">#def roughnessAsACI (Sxx, norm =&#39;global&#39;):</span>
<span class="c1">#def acousticGradientIndex(Sxx, dt, order=1, norm=None, n_pyr=1, display=False):</span>
<span class="c1">#def raoQ (p, bins):</span>
<span class="c1">#def hpss =&gt; harmonic vs percussion (voir librosa) librosa.decompose.hpss</span>
    
<span class="c1">#=============================================================================</span>
<span class="c1">#       </span>
<span class="c1">#   New ecoacoustics indices introduced by S. HAUPERT, 2020</span>
<span class="c1">#   </span>
<span class="c1">#============================================================================= </span>

<div class="viewcode-block" id="raoQ"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.raoQ.html#features.alpha_indices.raoQ">[docs]</a><span class="k">def</span> <span class="nf">raoQ</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        compute Rao&#39;s Quadratic entropy in 1d</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># be sure they are ndarray</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
    
    <span class="c1"># Normalize p by the sum in order to get the sum of p = 1</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    
    <span class="c1"># take advantage of broadcasting, </span>
    <span class="c1"># Get the pairwise distance </span>
    <span class="c1"># Euclidian distance</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">bins</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
    <span class="c1"># Keep only the upper triangle (symmetric)</span>
    <span class="c1">#d = np.triu(d, 0)</span>
        
    <span class="c1"># compute the crossproduct of pixels value pi,pj</span>
    <span class="n">pipj</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
    <span class="c1">#pipj = np.triu(pipj, 0)</span>
    <span class="c1"># Multiply by 2 to take into account the lower triangle (symmetric)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">pipj</span><span class="o">*</span><span class="n">d</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">return</span> <span class="n">Q</span></div>

<span class="c1">#=============================================================================</span>

<div class="viewcode-block" id="surfaceRoughness"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.surfaceRoughness.html#features.alpha_indices.surfaceRoughness">[docs]</a><span class="k">def</span> <span class="nf">surfaceRoughness</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span><span class="s1">&#39;global&#39;</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Surface Roughness </span>
<span class="sd">    see wikipedia : https://en.wikipedia.org/wiki/Surface_roughness</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        2d : Spectrogram (i.e matrix of spectrum)</span>
<span class="sd">    </span>
<span class="sd">    norm : string, optional, default is &#39;global&#39;</span>
<span class="sd">        Determine if the ROUGHNESS is normalized by the sum on the whole frequencies</span>
<span class="sd">        (&#39;global&#39; mode) or by the sum of frequency bin per frequency bin </span>
<span class="sd">        (&#39;per_bin&#39;)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------        </span>
<span class="sd">    Ra_per_bin : 1d ndarray of scalars</span>
<span class="sd">        Arithmetical mean deviation from the mean line (global or per frequency bin)</span>
<span class="sd">        =&gt; ROUGHNESS value for each frequency bin</span>
<span class="sd">        </span>
<span class="sd">    Ra : scalar</span>
<span class="sd">        Arithmetical mean deviation from the mean line [mean (Ra_per_bin)]</span>
<span class="sd">        =&gt; mean ROUGHNESS value over Sxx </span>
<span class="sd">        </span>
<span class="sd">    Rq_per_bin : 1d ndarray of scalars</span>
<span class="sd">        Root mean squared of deviation from the mean line (global or per frequency bin)</span>
<span class="sd">        =&gt; RMS ROUGHNESS value for each frequency bin</span>
<span class="sd">        </span>
<span class="sd">    Rq : scalar</span>
<span class="sd">        Root mean squared of deviation from the mean line  [mean (Rq_per_bin)]</span>
<span class="sd">        =&gt; RMS ROUGHNESS value over Sxx </span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;per_bin&#39;</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">-</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        
    <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;global&#39;</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Sxx</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">-</span><span class="n">m</span>

    <span class="c1"># Arithmetic mean deviation</span>
    <span class="n">Ra_per_bin</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Ra</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Ra_per_bin</span><span class="p">)</span>

    <span class="n">Rq_per_bin</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">Rq</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Rq_per_bin</span><span class="p">)</span> 
    
    <span class="k">return</span> <span class="n">Ra_per_bin</span><span class="p">,</span> <span class="n">Rq_per_bin</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Rq</span></div>

<span class="c1">#=============================================================================    </span>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="intoOctave"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.intoOctave.html#features.alpha_indices.intoOctave">[docs]</a><span class="k">def</span> <span class="nf">intoOctave</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">thirdOctave</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        
    <span class="c1"># define the third octave or octave frequency vector in Hz.</span>
    <span class="k">if</span> <span class="n">thirdOctave</span> <span class="p">:</span>
        <span class="n">bin_octave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mf">31.5</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">160</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">315</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">630</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1250</span><span class="p">,</span><span class="mi">1600</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">2500</span><span class="p">,</span><span class="mi">3150</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">6300</span><span class="p">,</span><span class="mi">8000</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">12500</span><span class="p">,</span><span class="mi">16000</span><span class="p">,</span><span class="mi">20000</span><span class="p">])</span> <span class="c1"># third octave band.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bin_octave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span><span class="mf">31.5</span><span class="p">,</span><span class="mi">63</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">8000</span><span class="p">,</span><span class="mi">16000</span><span class="p">])</span> <span class="c1"># octave</span>

    <span class="c1"># Bins limit</span>
    <span class="n">bin_octave_low</span> <span class="o">=</span> <span class="n">bin_octave</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.1666666</span><span class="p">)</span>
    <span class="n">bin_octave_up</span> <span class="o">=</span> <span class="n">bin_octave</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mf">0.1666666</span><span class="p">)</span>
       
    <span class="c1"># select the indices corresponding to the frequency bins range</span>
    <span class="n">x_octave</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_octave</span><span class="p">)):</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">fn</span><span class="o">&gt;=</span><span class="n">bin_octave_low</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>  <span class="o">*</span> <span class="p">(</span><span class="n">fn</span><span class="o">&lt;=</span><span class="n">bin_octave_up</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
        <span class="n">x_octave</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">,],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    
    <span class="n">x_octave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_octave</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="n">display</span> <span class="p">:</span>
        <span class="n">x_octave_dB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">x_octave</span><span class="p">)</span>
        <span class="n">fig_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;vmax&#39;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_octave_dB</span><span class="p">),</span>
                      <span class="s1">&#39;vmin&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span>
                      <span class="s1">&#39;extent&#39;</span><span class="p">:(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_octave_dB</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_octave</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span>
                      <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">4</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span>
                      <span class="s1">&#39;yticks&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_octave</span><span class="p">)),</span> <span class="n">bin_octave</span><span class="p">),</span>
                      <span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="s1">&#39;Power Spectrogram&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span><span class="s1">&#39;Time [sec]&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">,</span>
                      <span class="p">}</span>
        <span class="n">plot2D</span><span class="p">(</span><span class="n">x_octave_dB</span><span class="p">,</span><span class="o">**</span><span class="n">fig_kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x_octave</span><span class="p">,</span> <span class="n">bin_octave</span></div>

<span class="c1">#def tfsdt (Sxx, f , flim = (2000,6000), nbwindows = 1) :</span>
<span class="c1">#</span>
<span class="c1">#  # Warning, this index was initially developed to work from a third octave spectrogram with a time sampling of 125 ms.</span>
<span class="c1">#  </span>
<span class="c1">#  toctave = np.array([16,20,25,31.5,40,50,63,80,100,125,160,200,250,315,400,500,630,800,1000,1250,1600,2000,2500,3150,4000,5000,6300,8000,10000,12500,16000,20000]) # third octave band. </span>
<span class="c1">#  toctavemin = toctave/(2**0.1666666)</span>
<span class="c1">#  toctavemax = toctave*(2**0.1666666)</span>
<span class="c1">#  imin = (abs(toctave-flim[0])).argmin()</span>
<span class="c1">#  imax = (abs(toctave-flim[1])).argmin()</span>
<span class="c1">#  </span>
<span class="c1">#  bin = 1</span>
<span class="c1">##  spectoct[bin,]=sum(Sxx[indices]))</span>
<span class="c1">#</span>
<span class="c1">#    </span>
<span class="c1">#    # third-octave band values between [100 Hz, 8kHz] from narrow band frequency values.</span>
<span class="c1">#    bin = 1</span>
<span class="c1">#    for (j in seq(4, 23)) {</span>
<span class="c1">#      indices = which(freq&gt;toctavemin[j] &amp; freq &lt;toctavemax[j] )</span>
<span class="c1">#      L=0</span>
<span class="c1">#      spectoct[bin,]=10*log10(colSums(10^(z1[indices,]/10)))</span>
<span class="c1">#      bin =bin +1</span>
<span class="c1">#    }</span>
<span class="c1">#    </span>
<span class="c1">#    spectoctdf &lt;- (diff(spectoct)) </span>
<span class="c1">#    spectoctdft &lt;- (diff(t(spectoctdf)))</span>
<span class="c1">#    spectoctdft&lt;-t(spectoctdft)</span>
<span class="c1">#    </span>
<span class="c1">#    imin &lt;- imin - 4 # remove the three first third octave band [50-100 Hz[</span>
<span class="c1">#    imax &lt;- imax - 4 # remove the three first third octave band [50-100 Hz[</span>
<span class="c1">#    </span>
<span class="c1">#    tfsd &lt;- 0</span>
<span class="c1">#    for (ind in seq(imin, imax)) {</span>
<span class="c1">#      tfsd =  sum(abs(spectoctdft[ind,])) + tfsd  </span>
<span class="c1">#      }</span>
<span class="c1">#    tfsds[jj] &lt;- tfsd/sum(abs(spectoctdft))</span>
<span class="c1">#    rm(spectoct)</span>
<span class="c1">#  }</span>
<span class="c1">#  </span>
<span class="c1">#  return(na.omit(as.vector(tfsds)))</span>


<div class="viewcode-block" id="tfsd"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.tfsd.html#features.alpha_indices.tfsd">[docs]</a><span class="k">def</span> <span class="nf">tfsd</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">flim</span><span class="o">=</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">6000</span><span class="p">),</span> <span class="n">thirdOctave</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Time frequency derivation : tfsd</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        2d : Spectrogram (i.e matrix of spectrum)</span>
<span class="sd">    </span>
<span class="sd">    display : boolean, optional, default is False</span>
<span class="sd">        Display the 1st and 2nd derivation of the spectrogram</span>

<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    tfsd : 1d ndarray of scalars</span>
<span class="sd">        Acoustic Gradient Index of the spectrogram</span>
<span class="sd">        </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The higher the TFSD varies between 0 and 1, </span>
<span class="sd">    the greater the temporal presence of avian or human vocalizations.  </span>
<span class="sd">    With the default configuration, a TFSD &gt; 0.3 indicates a very important </span>
<span class="sd">    presence time of the vocalizations in the signal. </span>
<span class="sd">    The TFSD is always greater than 0.</span>
<span class="sd">       </span>
<span class="sd">    References </span>
<span class="sd">    ----------</span>
<span class="sd">    [1] Aumond, P., Can, A., De Coensel, B., Botteldooren, D., Ribeiro, C., &amp; Lavandier, C. (2017). </span>
<span class="sd">    Modeling soundscape pleasantness using perceptual assessments and acoustic measurements </span>
<span class="sd">    along paths in urban context. Acta Acustica united with Acustica,</span>
<span class="sd">    [2] Gontier, F., Lavandier, C., Aumond, P., Lagrange, M., &amp; Petiot, J. F. (2019). </span>
<span class="sd">    Estimation of the perceived time of presence of sources in urban acoustic environments </span>
<span class="sd">    using deep learning techniques. Acta Acustica united with Acustica, </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># convert into 1/3 octave</span>
    <span class="k">if</span> <span class="n">thirdOctave</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span> 
        <span class="n">x</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">intoOctave</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">thirdOctave</span><span class="o">=</span><span class="n">thirdOctave</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="n">display</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">Sxx</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">fn</span>

    <span class="c1"># Derivation along the time axis, for each frequency bin</span>
    <span class="n">GRADdt_xx</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Derivation of the previously derivated matrix along the frequency axis </span>
    <span class="n">GRADdf_xx</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">GRADdt_xx</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># select the bandwidth</span>
    <span class="n">GRADdf_xx_select</span> <span class="o">=</span> <span class="n">GRADdf_xx</span><span class="p">[</span><span class="n">index_bw</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bw</span><span class="o">=</span><span class="n">flim</span><span class="p">),]</span>
    
    <span class="c1"># calcul of the tfsdt : sum of the pseudo-gradient in the frequency bandwidth</span>
    <span class="c1"># which is normalized by the total sum of the pseudo-gradient</span>
    <span class="n">tfsd</span> <span class="o">=</span>  <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">GRADdf_xx_select</span><span class="p">))</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">GRADdf_xx</span><span class="p">))</span> 
    <span class="n">tfsd_per_bin</span> <span class="o">=</span>  <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">GRADdf_xx_select</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">GRADdf_xx</span><span class="p">))</span> 
    
    <span class="k">if</span> <span class="n">display</span><span class="o">==</span><span class="kc">True</span> <span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># set the paramteers of the figure</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span> <span class="p">(</span><span class="mi">13</span><span class="p">)</span>
                    
            <span class="c1"># display image</span>
            <span class="n">_im1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">linear2dB</span><span class="p">(</span><span class="n">GRADdt_xx</span><span class="p">),</span> 
                              <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">linear2dB</span><span class="p">(</span><span class="n">GRADdt_xx</span><span class="p">)),</span> <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span>
                              <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> 
                              <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">_im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
            
            <span class="c1"># set the parameters of the subplot</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Derivation along time axis&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [sec]&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>   
            <span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span> 
            
            <span class="c1"># display image</span>
            <span class="n">_im2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">linear2dB</span><span class="p">(</span><span class="n">GRADdf_xx</span><span class="p">),</span> 
                              <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">linear2dB</span><span class="p">(</span><span class="n">GRADdf_xx</span><span class="p">)),</span> <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span>
                              <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> 
                              <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">_im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
       
            <span class="c1"># set the parameters of the subplot</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Derivation along frequency axis&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [sec]&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span> 
         
            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
             
            <span class="c1"># Display the figure now</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">tfsd</span><span class="p">,</span> <span class="n">tfsd_per_bin</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="acousticGradientIndex"><a class="viewcode-back" href="../../_autosummary/features.alpha_indices.acousticGradientIndex.html#features.alpha_indices.acousticGradientIndex">[docs]</a><span class="k">def</span> <span class="nf">acousticGradientIndex</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_pyr</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic Gradient Index : AGI</span>
<span class="sd">    </span>
<span class="sd">    !!! Must be calculated on raw spectrogram (background noise must remain)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        2d : Spectrogram (i.e matrix of spectrum)</span>
<span class="sd">    </span>
<span class="sd">    dt : float</span>
<span class="sd">        Time resolution in seconds. </span>
<span class="sd">    </span>
<span class="sd">    norm : string, optional, default is &#39;per_bin&#39;</span>
<span class="sd">        Determine if the AGI is normalized by the global meaian value </span>
<span class="sd">        (&#39;global&#39; mode) or by the median value per frequency bin </span>
<span class="sd">        (&#39;per_bin&#39;)</span>
<span class="sd">        </span>

<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    AGI_xx : 2d ndarray of scalars</span>
<span class="sd">        Acoustic Gradient Index of the spectrogram</span>
<span class="sd">    </span>
<span class="sd">    AGI_per_bin : 1d ndarray of scalars</span>
<span class="sd">        AGI value for each frequency bin</span>
<span class="sd">        sum(AGI_xx,axis=1)</span>
<span class="sd">        </span>
<span class="sd">    AGI_sum : scalar</span>
<span class="sd">        Sum of AGI value per frequency bin (Common definition)</span>
<span class="sd">        sum(AGI_per_bin)</span>
<span class="sd">        </span>
<span class="sd">    AGI_mean ; scalar</span>
<span class="sd">        average AGI value per frequency bin (independant of the number of </span>
<span class="sd">        frequency bin)</span>
<span class="sd">        mean(AGI_per_bin)</span>
<span class="sd">           </span>
<span class="sd">    &quot;&quot;&quot;</span>     
    
    <span class="n">AGI_xx_pyr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">AGI_per_bin_pyr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">AGI_mean_pyr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">AGI_sum_pyr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dt_pyr</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_pyr</span><span class="p">):</span>  
        
<span class="c1">#        # Show the Leq energy in order to control that the conservation of</span>
<span class="c1">#        # energy is preserved</span>
<span class="c1">#        PSDxx_mean = mean(Sxx**2,axis=1)</span>
<span class="c1">#        leq = 10*log10(sum(PSDxx_mean)/(20e-6)**2)</span>
<span class="c1">#        print(leq)</span>
        
        <span class="c1"># derivative (order = 1, 2, 3...)</span>
        <span class="n">AGI_xx</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">dt</span><span class="o">**</span><span class="n">order</span> <span class="p">)</span>
        
        <span class="c1">#print(&#39;PYRAMID: %d / median ATI: %f / size: %s&#39; % (n, median(AGI_xx), AGI_xx.shape))</span>
        
        <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="p">:</span>
            <span class="c1"># Normalize the derivative by the median derivative which should </span>
            <span class="c1"># correspond to the background (noise) derivative</span>
            <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span><span class="s1">&#39;per_bin&#39;</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">AGI_xx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    
                <span class="n">m</span><span class="p">[</span><span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MIN_</span>    <span class="c1"># Avoid dividing by zero value</span>
                <span class="n">AGI_xx</span> <span class="o">=</span> <span class="n">AGI_xx</span><span class="o">/</span><span class="n">m</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;global&#39;</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">AGI_xx</span><span class="p">)</span> 
                <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="n">_MIN_</span> 
                <span class="n">AGI_xx</span> <span class="o">=</span> <span class="n">AGI_xx</span><span class="o">/</span><span class="n">m</span>

        <span class="c1"># mean per bin </span>
        <span class="n">AGI_per_bin</span> <span class="o">=</span> <span class="n">mean</span> <span class="p">(</span><span class="n">AGI_xx</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> 
        <span class="c1"># Mean global</span>
        <span class="n">AGI_mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">AGI_per_bin</span><span class="p">)</span> 
        <span class="c1"># Sum Global</span>
        <span class="n">AGI_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">AGI_per_bin</span><span class="p">)</span>

        <span class="c1"># add to the lists</span>
        <span class="n">AGI_xx_pyr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AGI_xx</span><span class="p">)</span>        
        <span class="n">AGI_per_bin_pyr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AGI_per_bin</span><span class="p">)</span>
        <span class="n">AGI_mean_pyr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AGI_mean</span><span class="p">)</span>
        <span class="n">AGI_sum_pyr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AGI_sum</span><span class="p">)</span>
        <span class="n">dt_pyr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>

        <span class="c1"># build next pyramid level (gaussian filter then reduce)</span>
        <span class="c1"># Sigma for gaussian filter. Default is 2 * downscale / 6.0 </span>
        <span class="c1"># which corresponds to a filter mask twice the size of the scale factor </span>
        <span class="c1"># that covers more than 99% of the gaussian distribution.</span>
        <span class="c1"># The total energy is kept</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="mi">2</span> <span class="c1"># the resolution decreases by 2 = x2</span>
        <span class="n">PSDxx</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># blur the image only on axis 1 (time axis)</span>
        <span class="n">PSDxx_blur</span> <span class="o">=</span> <span class="n">ndi</span><span class="o">.</span><span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">PSDxx</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mf">6.0</span><span class="p">)</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">PSDxx_blur</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">PSDxx_blur</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
        <span class="c1">#  Reduce the size of the image by 2</span>
        <span class="n">PSDxx_reduced</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">PSDxx_blur</span><span class="p">,</span><span class="n">output_shape</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;reflect&#39;</span><span class="p">,</span> <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>      

        <span class="c1"># display full SPECTROGRAM in dB</span>
        <span class="k">if</span> <span class="n">display</span><span class="o">==</span><span class="kc">True</span> <span class="p">:</span>
            
            <span class="n">fig4</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="c1"># set the paramteers of the figure</span>
            <span class="n">fig4</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">fig4</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">fig4</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">fig4</span><span class="o">.</span><span class="n">set_figwidth</span> <span class="p">(</span><span class="mi">13</span><span class="p">)</span>
                    
            <span class="c1"># display image</span>
            <span class="n">_im</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">linear2dB</span><span class="p">(</span><span class="n">PSDxx_reduced</span><span class="p">),</span> 
                             <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> 
                             <span class="n">vmin</span> <span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">_im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">)</span>
     
            <span class="c1"># set the parameters of the subplot</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Spectrogram&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time [sec]&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
            <span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span> 
         
            <span class="n">fig4</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
             
            <span class="c1"># Display the figure now</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="c1"># back to amplitude</span>
        <span class="n">Sxx</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">PSDxx_reduced</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">AGI_xx_pyr</span> <span class="p">,</span> <span class="n">AGI_per_bin_pyr</span><span class="p">,</span> <span class="n">AGI_mean_pyr</span><span class="p">,</span> <span class="n">AGI_sum_pyr</span><span class="p">,</span> <span class="n">dt_pyr</span></div>


</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, scikit-maad development team.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
         .wy-nav-content { max-width: none; }
  </style>



</body>
</html>